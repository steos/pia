<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.1" />
<title>Pia - Annotations for PHP</title>
<style type="text/css">
/* Debug borders */
p, li, dt, dd, div, pre, h1, h2, h3, h4, h5, h6 {
/*
  border: 1px solid red;
*/
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

tt {
  color: navy;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  font-family: sans-serif;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}

div.sectionbody {
  font-family: serif;
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}

pre {
  padding: 0;
  margin: 0;
}

span#author {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  font-size: 1.1em;
}
span#email {
}
span#revnumber, span#revdate, span#revremark {
  font-family: sans-serif;
}

div#footer {
  font-family: sans-serif;
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
div#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
div#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

div#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.tableblock, div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid silver;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid silver;
  background: #f4f4f4;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #dddddd;
  color: #777777;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-family: sans-serif;
  font-weight: bold;
  color: #527bbd;
}
tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  div#footer-badges { display: none; }
}

div#toc {
  margin-bottom: 2.5em;
}

div#toctitle {
  color: #527bbd;
  font-family: sans-serif;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

/*
  pygmentize filter
*/
.highlight .hll { background-color: #ffffcc }
.highlight  { background: #f4f4f4; }
.highlight .c { color: #008800; font-style: italic } /* Comment */
.highlight .err { border: 1px solid #FF0000 } /* Error */
.highlight .k { color: #AA22FF; font-weight: bold } /* Keyword */
.highlight .o { color: #666666 } /* Operator */
.highlight .cm { color: #008800; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #008800 } /* Comment.Preproc */
.highlight .c1 { color: #008800; font-style: italic } /* Comment.Single */
.highlight .cs { color: #008800; font-weight: bold } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #808080 } /* Generic.Output */
.highlight .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0040D0 } /* Generic.Traceback */
.highlight .kc { color: #AA22FF; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #AA22FF; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #AA22FF; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #AA22FF } /* Keyword.Pseudo */
.highlight .kr { color: #AA22FF; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #00BB00; font-weight: bold } /* Keyword.Type */
.highlight .m { color: #666666 } /* Literal.Number */
.highlight .s { color: #BB4444 } /* Literal.String */
.highlight .na { color: #BB4444 } /* Name.Attribute */
.highlight .nb { color: #AA22FF } /* Name.Builtin */
.highlight .nc { color: #0000FF } /* Name.Class */
.highlight .no { color: #880000 } /* Name.Constant */
.highlight .nd { color: #AA22FF } /* Name.Decorator */
.highlight .ni { color: #999999; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #00A000 } /* Name.Function */
.highlight .nl { color: #A0A000 } /* Name.Label */
.highlight .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #008000; font-weight: bold } /* Name.Tag */
.highlight .nv { color: #B8860B } /* Name.Variable */
.highlight .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mf { color: #666666 } /* Literal.Number.Float */
.highlight .mh { color: #666666 } /* Literal.Number.Hex */
.highlight .mi { color: #666666 } /* Literal.Number.Integer */
.highlight .mo { color: #666666 } /* Literal.Number.Oct */
.highlight .sb { color: #BB4444 } /* Literal.String.Backtick */
.highlight .sc { color: #BB4444 } /* Literal.String.Char */
.highlight .sd { color: #BB4444; font-style: italic } /* Literal.String.Doc */
.highlight .s2 { color: #BB4444 } /* Literal.String.Double */
.highlight .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.highlight .sh { color: #BB4444 } /* Literal.String.Heredoc */
.highlight .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.highlight .sx { color: #008000 } /* Literal.String.Other */
.highlight .sr { color: #BB6688 } /* Literal.String.Regex */
.highlight .s1 { color: #BB4444 } /* Literal.String.Single */
.highlight .ss { color: #B8860B } /* Literal.String.Symbol */
.highlight .bp { color: #AA22FF } /* Name.Builtin.Pseudo */
.highlight .vc { color: #B8860B } /* Name.Variable.Class */
.highlight .vg { color: #B8860B } /* Name.Variable.Global */
.highlight .vi { color: #B8860B } /* Name.Variable.Instance */
.highlight .il { color: #666666 } /* Literal.Number.Integer.Long */

</style>
<script type="text/javascript">
/*<![CDATA[*/
window.onload = function(){asciidoc.footnotes();}
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([2-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  var cont = document.getElementById("content");
  var noteholder = document.getElementById("footnotes");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      // Use [\s\S] in place of . so multi-line matches work.
      // Because JavaScript has no s (dotall) regex flag.
      note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      spans[i].innerHTML =
        "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
        "' title='View footnote' class='footnote'>" + n + "</a>]";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
}

}
/*]]>*/
</script>
</head>
<body class="article">
<div id="header">
<h1>Pia - Annotations for PHP</h1>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph"><p>Pia is a small API to emulate Java-like annotations in PHP.
Many PHP project already use some sort of custom-built annotation mechanism,
one of the most prominent examples being PHPUnit. Pia takes those approaches
one step further by implementing a full-fledged context-free grammar.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_basics">Basics</h2>
<div class="sectionbody">
<div class="paragraph"><p>Let&#8217;s start with an example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="sd">/**</span>
<span class="sd">  * @my.awesome.annotation(</span>
<span class="sd">  *   foo=&amp;quot; b a r &amp;quot;,</span>
<span class="sd">  *   bar=3.1</span>
<span class="sd">  *   baz=[&amp;quot;lorem&amp;quot;, &amp;quot;ipsum&amp;quot;]</span>
<span class="sd">  * )</span>
<span class="sd">  */</span>
  <span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
      <span class="c1">// code</span>
  <span class="p">}</span>
</pre></div></div></div>
<div class="paragraph"><p>A pia annotation can be named arbitrarily, there are no restrictions for the
name except that it cannot contain whitespace. Every annotation can define named
parameters. If it has no parameters the parenthesis can be omitted. Parameter
values can be strings, integers, floats, booleans and arrays (including
associative arrays) as well as the null literal. Let&#8217;s look at another
example:</p></div>
<div class="paragraph"><p>Let&#8217;s look at another example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="sd">/**</span>
<span class="sd">  * @foobar(arr=[</span>
<span class="sd">  *     &quot;a&quot;:true,</span>
<span class="sd">  *     &quot;b&quot;:null,</span>
<span class="sd">  *     &quot;c&quot;:false,</span>
<span class="sd">  *     &quot;d:&quot;:3.14159265,</span>
<span class="sd">  *     &quot;e&quot;:[1, 2, 3],</span>
<span class="sd">  *     &quot;f&quot;:[&quot;a&quot;:[1, 2], b:[true, false]]</span>
<span class="sd">  * ])</span>
<span class="sd">  */</span>
</pre></div></div></div>
<div class="paragraph"><p>As you can see the array notation is borrowed from JSON and arrays can be nested
arbitrarily.</p></div>
<div class="paragraph"><p>The asterisk is ignored by the parser, just like whitespace. That means you can
do stuff like this:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="sd">/*************</span>
<span class="sd"> * @foo(x=1, *</span>
<span class="sd"> *      y=2, *</span>
<span class="sd"> *      z=3) *</span>
<span class="sd"> *************/</span>
</pre></div></div></div>
<div class="paragraph"><p>The parser also ignores anything before and after an annotation. However once an
@ is encountered it expects a well-formed annotation. Therefore the following
can be parsed without problems:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="sd">/**</span>
<span class="sd">  * lorem ipsum</span>
<span class="sd">  * @annotation lorem</span>
<span class="sd">  * ipsum @another.annotation lorem</span>
<span class="sd">  * ipsum @and.another(foo=&quot;bar&quot;, bar=42) lorem</span>
<span class="sd">  * ipsum</span>
<span class="sd">  */</span>
</pre></div></div></div>
</div>
</div>
<div class="sect1">
<h2 id="_the_api">The API</h2>
<div class="sectionbody">
<div class="paragraph"><p>The Pia API can be used to retrieve (i.e. parse) annotations on the fly at
runtime. In order to retrieve the phpdoc which contains the annotations it is
necessary to use the reflection API.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">pia\Registry</span><span class="p">;</span>

<span class="nv">$reflect</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\ReflectionClass</span><span class="p">(</span><span class="s1">&#39;MyAnnotatedClass&#39;</span><span class="p">);</span>
<span class="nv">$annotations</span> <span class="o">=</span> <span class="nx">Registry</span><span class="o">::</span><span class="na">getAnnotations</span><span class="p">(</span><span class="nv">$reflect</span><span class="p">);</span>
</pre></div></div></div>
<div class="paragraph"><p>Because reflection is generally slow it is not recommended to use the API in
this manner if performance matters (note that the annotations will be cached in
memory by the registry therefore repeating the call won&#8217;t reparse the phpdoc
comment).</p></div>
<div class="paragraph"><p>Fortunately Pia provides a simple alternative that&#8217;s pretty much as fast as
possible in PHP userland. Because annotations are compile-time metadata we can
simply preprocess the annotated codebase and compile the annotations into an
array.</p></div>
<div class="paragraph"><p>For this purpose Pia comes with a small CLI script (bin/pia.php) that you can
use to process your source code. The script expects two parameters, the first
one being either a file or a directory while the second parameter specifies the
output file. The code generated by the script looks like this:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// generated by Pia</span>
<span class="c1">// 2010-06-17T11:36:07+02:00</span>
<span class="k">return</span> <span class="k">array</span><span class="p">(</span>
<span class="s1">&#39;Foo&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
<span class="k">new</span> <span class="nx">\pia\Annotation</span><span class="p">(</span><span class="s1">&#39;foobar&#39;</span><span class="p">,</span> <span class="k">array</span> <span class="p">(</span>
  <span class="s1">&#39;foo&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span>
  <span class="s1">&#39;bar&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;baz&#39;</span><span class="p">,</span>
<span class="p">)),</span>
<span class="p">),</span>
<span class="p">);</span>
</pre></div></div></div>
<div class="paragraph"><p>You don&#8217;t need to concern yourself with this detail though. You only need to
load this file with the Registry using its load method:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">pia\Registry</span><span class="p">;</span>
<span class="nv">$reg</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Registry</span><span class="p">();</span>
<span class="nv">$reg</span><span class="o">-&gt;</span><span class="na">load</span><span class="p">(</span><span class="s1">&#39;annotations.php&#39;</span><span class="p">);</span>
</pre></div></div></div>
<div class="paragraph"><p>Now if you want to lookup the annotations of a specific element without using
the reflection API you need to know how Pia maps PHP code elements to unique
array keys. The rules are very simple: the key of a class is simply it&#8217;s name,
the key of a method is <tt>&lt;class name&gt;::&lt;method name&gt;</tt> and the key of a property is
<tt>&lt;class name&gt;::$&lt;property name&gt;</tt>. The key for a function is its name prefixed by
the hash symbol (#).</p></div>
<div class="paragraph"><p>Therefore if we define the following class:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="sd">/**</span>
<span class="sd"> * @foobar(foo=&quot;bar&quot;, bar=&quot;baz&quot;)</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">Foo</span> <span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @another.annotation</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="nv">$bar</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @and.another.one</span>
<span class="sd">     */</span>
    <span class="k">function</span> <span class="nf">baz</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// code</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div></div></div>
<div class="paragraph"><p>You can lookup the annotations the following way:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">pia\Registry</span><span class="p">;</span>
<span class="nv">$reg</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Registry</span><span class="p">;</span>
<span class="nv">$reg</span><span class="o">-&gt;</span><span class="na">load</span><span class="p">(</span><span class="s1">&#39;annotations.php&#39;</span><span class="p">);</span>

<span class="nv">$reg</span><span class="o">-&gt;</span><span class="na">hasAnnotations</span><span class="p">(</span><span class="s1">&#39;Foo&#39;</span><span class="p">);</span>
<span class="nv">$reg</span><span class="o">-&gt;</span><span class="na">hasAnnotations</span><span class="p">(</span><span class="s1">&#39;Foo::baz&#39;</span><span class="p">);</span>
<span class="nv">$reg</span><span class="o">-&gt;</span><span class="na">hasAnnotations</span><span class="p">(</span><span class="s1">&#39;Foo::$bar&#39;</span><span class="p">);</span>
</pre></div></div></div>
<div class="sect2">
<h3 id="_annotation_lookup">Annotation lookup</h3>
<div class="paragraph"><p>It is often desired to retrieve elements with a specific annotation therefore
the Pia registry provides a function called find for this purpose.</p></div>
<div class="paragraph"><p>Example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">pia\Registry</span><span class="p">;</span>
<span class="nv">$reg</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Registry</span><span class="p">;</span>
<span class="nv">$reg</span><span class="o">-&gt;</span><span class="na">load</span><span class="p">(</span><span class="s1">&#39;annotations.php&#39;</span><span class="p">);</span>
<span class="nv">$elements</span> <span class="o">=</span> <span class="nv">$reg</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;my.cool.annotation&#39;</span><span class="p">);</span>
</pre></div></div></div>
<div class="paragraph"><p>Because the registry internally stores the annotations in an array indexed by
a key based on the annotated element name (see above) a linear search is
required to extract elements with a specific annotation. To optimize this the
registry contains a setting called reverseIndexEnabled which, if set to true,
causes the registry to additionally build a reverse index of the annotations,
i.e. it puts all annotated elements into an array indexed by annotation name
thus enabling constant time lookup.</p></div>
<div class="paragraph"><p>Example usage:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">pia\Registry</span><span class="p">;</span>
<span class="nv">$reg</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Registry</span><span class="p">;</span>
<span class="c1">// enable reverse index so we can</span>
<span class="c1">// find elements with a specific annotation in</span>
<span class="c1">// constant time</span>
<span class="nv">$reg</span><span class="o">-&gt;</span><span class="na">setReverseIndexEnabled</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
<span class="nv">$reg</span><span class="o">-&gt;</span><span class="na">load</span><span class="p">(</span><span class="s1">&#39;annotations.php&#39;</span><span class="p">);</span>
<span class="nv">$elements</span> <span class="o">=</span> <span class="nv">$reg</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;my.cool.annotation&#39;</span><span class="p">);</span>
</pre></div></div></div>
<div class="paragraph"><p>The find function returns an array of appropriate reflection instances for each
matching element.</p></div>
</div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated 2010-09-10 12:21:00 Westeuropäische Sommerzeit
</div>
</div>
</body>
</html>
